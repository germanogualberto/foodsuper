<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Pedidos</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="/style.css" />
    <script>
        function carregaPedidos(){
            atualizaPedidos()
        }
    </script>
</head>
<body onload="carregaPedidos()">

    <h1>Pedidos</h1>
    <div id="pedidos"></div>
    
    
    Pedido1 Status<br>
    Pedido2 Status<br>
    <button onclick="voltarTelaPrincipal()">Voltar</button>
    <script>
        function atualizaPedidos(){
            var dados = getPedidos();
            var ids = [];
            console.log(dados);

            var element = document.getElementById("pedidos");
            element.innerHTML = "";
            for (i in dados) {
                var button = document.createElement("button");
                button.innerHTML = dados[i]._id;
                console.log(dados[i]._id);
                ids.push(dados[i]._id);
                //button.id = ids[i]
                button.id = dados[i]._id;

                //para.href = "prateleira.html";
                var list = document.getElementById("pedidos");
                list.appendChild(button);
                //para.appendChild(node);
                //para.appendChild(br);


                //element.appendChild(para);
                button.addEventListener("click", function () {
                    //alert(ids[1]);
                    //atualizaCarrinho(this.id);
                    //carrinho.push(this.id)
                    console.log(this.id);
                    localStorage.setItem('idPedido',this.id);
                    telaDetalhePedido()
                    //verPrateleira();
                });

            }
        }
        
        function telaDetalhePedido() {
            window.location.href = "pedido.html";
        }

        function getPedidos(){
            const Http = new XMLHttpRequest();
            const url = 'http://localhost:3000/pedidos/' + localStorage.getItem('_id');
            Http.open("GET", url, false);
            Http.setRequestHeader('Authorization', 'Bearer ' + localStorage.getItem('token'));

            Http.send(null);

            var obj = JSON.parse(Http.responseText);
            //alert(obj.token);

            Http.onreadystatechange = (e) => {
                console.log(Http.responseText);
                // Request finished. Do processing here.
            };

            console.log('aqui1');
            console.log(localStorage.getItem('_id'));
            console.log(localStorage.getItem('token'));
            console.log(Http.status);
            console.log(obj);
            console.log('aqui2');
            return obj;
        }

    function voltarTelaPrincipal() {
        window.location.href = "mainUsuario.html";
    }
    </script>
</body>
</html>